// Traducciones para los idiomas
const translations = {
    es: {
        // Títulos y textos principales
        "app-title": "Aprende En Tu Hogar",
        "app-tagline": "Tu futuro, Tú lo elijes",
        "offline-text": "Offline",
        "courses-title": "Cursos Disponibles",
        
        // Nombres de cursos
        "math-title": "Matemática",
        "math-desc": "Suma, resta, multiplicación, división, potencias y raíces cuadradas",
        "com-title": "Comunicación",
        "com-desc": "Gramática, comprensión lectora y expresión escrita",
        "sci-title": "Ciencias",
        "sci-desc": "Biología, física y química",
        "hist-title": "Historia del Perú",
        "hist-desc": "Desde las culturas preincaicas hasta la época republicana",
        
        // Botones y textos comunes
        "start-course": "Comenzar Curso",
        "question": "Pregunta",
        "of": "de",
        "prev": "Anterior",
        "next": "Siguiente",
        "finish": "Finalizar",
        
        // Resultados
        "completed": "¡Curso Completado!",
        "back-courses": "Volver a Cursos",
        "repeat-course": "Repetir Curso",
        
        // Instalación
        "install-here": "INSTALACIÓN AQUI",
        "install-app": "Instalar App",
        "footer-desc": "Aprende En Tu Hogar diseñada para zonas rurales sin conexión a internet",
        
        // Alertas y mensajes
        "select-answer": "Por favor, selecciona una respuesta antes de continuar.",
        "excellent-score": "¡Excelente! Has respondido todas las preguntas correctamente.",
        "good-score": "¡Muy bien! Has demostrado un buen conocimiento del tema.",
        "medium-score": "Buen trabajo, pero puedes mejorar. Revisa los temas y vuelve a intentarlo.",
        "low-score": "Sigue practicando. Revisa los conceptos y vuelve a intentarlo."
    },
    
    qu: {
        // Títulos y textos principales
        "app-title": "Yachay Wasipi",
        "app-tagline": "Qhepaman, Qanqa akllanki",
        "offline-text": "Mana Internetpi",
        "courses-title": "Kawsay Yachaykunas",
        
        // Nombres de cursos
        "math-title": "Yupana Yachay",
        "math-desc": "Yapay, qichuy, miray, rakisqa, hatunyachiy, sikwiracha",
        "com-title": "Rimay Yachay",
        "com-desc": "Simi kamachiy, qillqasqa hamut'ay, qillqay",
        "sci-title": "Kamay Yachay",
        "sci-desc": "Kawsay yachay, llamk'ay yachay, ch'ilan yachay",
        "hist-title": "Piruwpa ñawpaq kawsaynin",
        "hist-desc": "Ñawpaq Inka pachamanta kamakuna Republican pachakama",
        
        // Botones y textos comunes
        "start-course": "Yachayta Qallariy",
        "question": "Tapuy",
        "of": "manta",
        "prev": "Ñawpaqman",
        "next": "Qhipaman",
        "finish": "Tukuchiy",
        
        // Resultados
        "completed": "¡Yachay Tukusqa!",
        "back-courses": "Yachaykunaman Kutiy",
        "repeat-course": "Yachayta Kutichiymanta",
        
        // Instalación
        "install-here": "WILLAY CHURANA KAYPI",
        "install-app": "Appta Churanay",
        "footer-desc": "Yachay Wasipi internetniyuq mana llaqtakunapaq kamachisqa",
        
        // Alertas y mensajes
        "select-answer": "Ama hina kaspa, kutichiyta akllay qhipaman riyta munaspa.",
        "excellent-score": "¡Ancha allin! Llapanta allinta kutichirqanki.",
        "good-score": "¡Allinmi! Yachaykimantam rikuchirqanki.",
        "medium-score": "Allin llamk'ay, ichaqa aswan allin kanman. T'eqsimanta qhawaspam, kutichiy.",
        "low-score": "Yachayta llamk'achkaspalla. T'eqsimanta qhawaspam, kutichiy."
    },
    
    ay: {
        // Títulos y textos principales
        "app-title": "Yatiqaña Utampi",
        "app-tagline": "Qhipa uru, jumataki akhamawa",
        "offline-text": "Jan Internetpi",
        "courses-title": "Yatiqañataki yatiyañanaka",
        
        // Nombres de cursos
        "math-title": "Yupay Yatiqaña",
        "math-desc": "Yapayaña, juch'ayaña, jisk'a mayjt'ayaña, jaljayaña, jach'a yatiyaña, k'uchu tupu",
        "com-title": "Aru Yatiqaña",
        "com-desc": "Aru kamachi, qillqa amuyaña, qillqayaña",
        "sci-title": "Yatichaña",
        "sci-desc": "Kawsay yatiyaña, ch'ama yatiyaña, qullqi yatiyaña",
        "hist-title": "Piruwpa nayra pacha",
        "hist-desc": "Nayra Inka pachamanta kamakuna República pachakama",
        
        // Botones y textos comunes
        "start-course": "Yatiqañata Qalltaña",
        "question": "Jiskt'a",
        "of": "manta",
        "prev": "Nayraman",
        "next": "Qhipaman",
        "finish": "Tukuyaña",
        
        // Resultados
        "completed": "¡Yatiqaña Tuku!",
        "back-courses": "Yatiqañanakarux Kutixaña",
        "repeat-course": "Yatiqañata Kutixaña",
        
        // Instalación
        "install-here": "UÑJAWI CHURANA AKANXA",
        "install-app": "Appta Churaña",
        "footer-desc": "Yatiqaña Utampi internetni jan markanakataki kamachi",
        
        // Alertas y mensajes
        "select-answer": "Ukat janiw, jiskt'äwi ajlliñ munañ qhiparu sarxañ muni.",
        "excellent-score": "¡Wali sumawa! Tukuyax wali sum jiskt'äw uñtawaytawa.",
        "good-score": "¡Sumawa! Yatixatäw uñjachawaytawa.",
        "medium-score": "Suma llamk'äwi, ukax wakiskiriw suma katuqäkiti. Yatiqäwinak uñt'asisxaniwa, kutiyaña.",
        "low-score": "Yatiqañatakiw llamk'chañawa. Yatiqäwinak uñt'asisxaniwa, kutiyaña."
    }
};

// Traducciones de preguntas para cada curso
const questionTranslations = {
    es: {}, // Español ya tiene las preguntas originales
    qu: {
        "matematica": [
            { 
                question: "¿Imaynataq 15 + 27?", 
                options: ["42", "32", "52", "37"], 
                correct: 0 
            },
            { 
                question: "¿Imaynataq 48 - 19?", 
                options: ["27", "29", "31", "39"], 
                correct: 1 
            },
            { 
                question: "¿Imaynataq 7 × 8?", 
                options: ["54", "56", "64", "48"], 
                correct: 1 
            },
            { 
                question: "¿Imaynataq 81 ÷ 9?", 
                options: ["7", "8", "9", "10"], 
                correct: 2 
            },
            { 
                question: "¿Imaynataq 25 + 38?", 
                options: ["53", "63", "73", "83"], 
                correct: 1 
            },
            { 
                question: "¿Imaynataq 72 - 45?", 
                options: ["27", "37", "47", "17"], 
                correct: 0 
            },
            { 
                question: "¿Imaynataq 9 × 6?", 
                options: ["54", "56", "64", "48"], 
                correct: 0 
            },
            { 
                question: "¿Imaynataq 64 ÷ 8?", 
                options: ["7", "8", "9", "6"], 
                correct: 1 
            },
            { 
                question: "¿Imaynataq 1/2 + 1/4?", 
                options: ["3/4", "1/2", "2/4", "1/8"], 
                correct: 0 
            },
            { 
                question: "¿Imaynataq 0.5 + 0.25?", 
                options: ["0.75", "0.5", "0.25", "1.0"], 
                correct: 0 
            },
            { 
                question: "¿Imaynataq 50% de 200?", 
                options: ["100", "50", "150", "200"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin área kachkan cuadradopi ladon 5?", 
                options: ["25", "20", "15", "10"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin cuadrado kachkan 12?", 
                options: ["144", "124", "132", "121"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin raíz cuadrada kachkan 64?", 
                options: ["8", "6", "7", "9"], 
                correct: 0 
            }
        ],
        "comunicacion": [
            { 
                question: "¿Mayqin antónimo kachkan 'kusisqa'?", 
                options: ["Llaki", "Kusisqa", "Kusikuy", "Samiyuq"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin kay rimakuna sutin?", 
                options: ["Wasi", "Paway", "Anqas", "Utqay"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin sujeto kachkan 'Allqa parkepi pawaykun'?", 
                options: ["Allqa", "Pawaykun", "Parkepi", "Parke"], 
                correct: 0 
            },
            { 
                question: "¿Imayna rimam 'utqaylla'?", 
                options: ["Adverbio", "Suti", "Sutichaq", "Ruray"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin sinónimo kachkan 'yachaysapa'?", 
                options: ["Amawta", "Upa", "Ch'aki", "Q'ala"], 
                correct: 0 
            }
        ],
        "ciencias": [
            { 
                question: "¿Mayqin gas necesitan plantakuna fotosíntesispaq?", 
                options: ["Dióxido de carbono", "Oxígeno", "Nitrógeno", "Hidrógeno"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin órgano bombea yawar runapa kurpusninpi?", 
                options: ["Sonqo", "Surq'an", "Kukupin", "Ñutqu"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin animal mamífero?", 
                options: ["Ballena", "Tiburón", "Cocodrilo", "Pingüino"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin planeta riqsisqa planeta pukata?", 
                options: ["Marte", "Venus", "Júpiter", "Saturno"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin fuerza wañuchinchik Pacha Mama?", 
                options: ["Gravedad", "Magnetismo", "Electricidad", "Fricción"], 
                correct: 0 
            }
        ],
        "historia": [
            { 
                question: "¿Mayqin civilización ruwarqan Machu Picchu?", 
                options: ["Inka", "Chavín", "Moche", "Nazca"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin watapi declararqanku independencia Perú?", 
                options: ["1821", "1810", "1824", "1830"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin cultura preincaica riqsisqa Líneas de Nazca?", 
                options: ["Nazca", "Paracas", "Mochica", "Tiahuanaco"], 
                correct: 0 
            },
            { 
                question: "¿Pitaq karqan último inca Tahuantinsuyo?", 
                options: ["Atahualpa", "Pachacútec", "Huayna Cápac", "Manco Inca"], 
                correct: 0 
            },
            { 
                question: "¿Mayqin batalla sellarqan independencia Perú?", 
                options: ["Ayacucho", "Junín", "Angamos", "Miraflores"], 
                correct: 0 
            }
        ]
    },
    ay: {
        "matematica": [
            { 
                question: "¿Kawkjsa 15 + 27?", 
                options: ["42", "32", "52", "37"], 
                correct: 0 
            },
            { 
                question: "¿Kawkjsa 48 - 19?", 
                options: ["27", "29", "31", "39"], 
                correct: 1 
            },
            { 
                question: "¿Kawkjsa 7 × 8?", 
                options: ["54", "56", "64", "48"], 
                correct: 1 
            },
            { 
                question: "¿Kawkjsa 81 ÷ 9?", 
                options: ["7", "8", "9", "10"], 
                correct: 2 
            },
            { 
                question: "¿Kawkjsa 25 + 38?", 
                options: ["53", "63", "73", "83"], 
                correct: 1 
            },
            { 
                question: "¿Kawkjsa 72 - 45?", 
                options: ["27", "37", "47", "17"], 
                correct: 0 
            },
            { 
                question: "¿Kawkjsa 9 × 6?", 
                options: ["54", "56", "64", "48"], 
                correct: 0 
            },
            { 
                question: "¿Kawkjsa 64 ÷ 8?", 
                options: ["7", "8", "9", "6"], 
                correct: 1 
            },
            { 
                question: "¿Kawkjsa 1/2 + 1/4?", 
                options: ["3/4", "1/2", "2/4", "1/8"], 
                correct: 0 
            },
            { 
                question: "¿Kawkjsa 0.5 + 0.25?", 
                options: ["0.75", "0.5", "0.25", "1.0"], 
                correct: 0 
            },
            { 
                question: "¿Kawkjsa 50% de 200?", 
                options: ["100", "50", "150", "200"], 
                correct: 0 
            },
            { 
                question: "¿Kuna área tiykatxi cuadradopi ladon 5?", 
                options: ["25", "20", "15", "10"], 
                correct: 0 
            },
            { 
                question: "¿Kuna cuadrado tiykatxi 12?", 
                options: ["144", "124", "132", "121"], 
                correct: 0 
            },
            { 
                question: "¿Kuna raíz cuadrada tiykatxi 64?", 
                options: ["8", "6", "7", "9"], 
                correct: 0 
            }
        ],
        "comunicacion": [
            { 
                question: "¿Kuna antónimo tiykatxi 'kusiña'?", 
                options: ["Llaki", "Kusiña", "Kusisiña", "Saminchaña"], 
                correct: 0 
            },
            { 
                question: "¿Kuna kay aru sutin?", 
                options: ["Uta", "Phinayaña", "Ch'uxña", "Jank'oki"], 
                correct: 0 
            },
            { 
                question: "¿Kuna sujeto tiykatxi 'Anu parquepi phinayasi'?", 
                options: ["Anu", "Phinayasi", "Parquepi", "Parque"], 
                correct: 0 
            },
            { 
                question: "¿Kuna arup 'jank'oki'?", 
                options: ["Adverbio", "Suti", "Sutichiri", "Luraña"], 
                correct: 0 
            },
            { 
                question: "¿Kuna sinónimo tiykatxi 'yatiri'?", 
                options: ["Amtiri", "Juk'aki", "Ch'aki", "Q'ala"], 
                correct: 0 
            }
        ],
        "ciencias": [
            { 
                question: "¿Kuna gas plantanaka necesitan fotosíntesispa?", 
                options: ["Dióxido de carbono", "Oxígeno", "Nitrógeno", "Hidrógeno"], 
                correct: 0 
            },
            { 
                question: "¿Kuna órgano bombea wila jaqenaka kurpuspi?", 
                options: ["Lluqu", "Surq'an", "K'iwcha", "Lixwi"], 
                correct: 0 
            },
            { 
                question: "¿Kuna animal mamífero?", 
                options: ["Ballena", "Tiburón", "Cocodrilo", "Pingüino"], 
                correct: 0 
            },
            { 
                question: "¿Kuna planeta yati qhispi planeta pukata?", 
                options: ["Marte", "Venus", "Júpiter", "Saturno"], 
                correct: 0 
            },
            { 
                question: "¿Kuna fuerza jiwxapxi Pachamama?", 
                options: ["Gravedad", "Magnetismo", "Electricidad", "Fricción"], 
                correct: 0 
            }
        ],
        "historia": [
            { 
                question: "¿Kuna civilización lurt'xi Machu Picchu?", 
                options: ["Inka", "Chavín", "Moche", "Nazca"], 
                correct: 0 
            },
            { 
                question: "¿Kuna marapi declarapxi independencia Piruw?", 
                options: ["1821", "1810", "1824", "1830"], 
                correct: 0 
            },
            { 
                question: "¿Kuna cultura preincaica yati qhispi Líneas de Nazca?", 
                options: ["Nazca", "Paracas", "Mochica", "Tiahuanaco"], 
                correct: 0 
            },
            { 
                question: "¿Khiti karxi último inca Tahuantinsuyo?", 
                options: ["Atahualpa", "Pachacútec", "Huayna Cápac", "Manco Inca"], 
                correct: 0 
            },
            { 
                question: "¿Kuna batalla sellarxi independencia Piruw?", 
                options: ["Ayacucho", "Junín", "Angamos", "Miraflores"], 
                correct: 0 
            }
        ]
    }
};

// Idioma actual (por defecto español)
let currentLanguage = 'es';

// Variable para almacenar las preguntas traducidas actuales
let translatedQuestions = {};

// Función para obtener preguntas traducidas
function getTranslatedQuestions(course) {
    // Si el idioma es español, usar las preguntas originales
    if (currentLanguage === 'es') {
        return null; // null indica usar preguntas originales
    }
    
    // Si hay traducciones para este curso en el idioma actual
    if (questionTranslations[currentLanguage] && questionTranslations[currentLanguage][course]) {
        return questionTranslations[currentLanguage][course];
    }
    
    return null; // No hay traducción, usar preguntas originales
}

// Función para mezclar preguntas
function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

// Función para seleccionar preguntas traducidas aleatorias
function selectTranslatedRandomQuestions(course) {
    const translated = getTranslatedQuestions(course);
    
    // Si no hay traducciones, devolver null para usar preguntas originales
    if (!translated) {
        return null;
    }
    
    // Mezclar y seleccionar 10 preguntas
    const shuffled = shuffleArray(translated);
    return shuffled.slice(0, 10);
}

// Cambiar idioma
function changeLanguage(lang) {
    currentLanguage = lang;
    
    // Actualizar botones de idioma
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.lang === lang) {
            btn.classList.add('active');
        }
    });
    
    // Actualizar todos los textos traducibles de la interfaz
    updateTexts();
    
    // Si hay un curso activo, actualizar las preguntas traducidas
    if (window.currentCourse && window.currentQuestionIndex !== undefined) {
        updateQuizQuestions();
    }
}

// Actualizar preguntas del quiz cuando cambia el idioma
function updateQuizQuestions() {
    if (window.currentCourse && window.selectedQuestions) {
        // Obtener nuevas preguntas traducidas
        const newQuestions = selectTranslatedRandomQuestions(window.currentCourse);
        
        if (newQuestions) {
            // Actualizar las preguntas seleccionadas
            window.selectedQuestions = newQuestions;
            
            // Reiniciar las respuestas del usuario
            window.userAnswers = new Array(newQuestions.length).fill(null);
            
            // Reiniciar al índice 0 si es necesario
            window.currentQuestionIndex = 0;
            
            // Actualizar la pregunta mostrada
            if (window.showQuestion) {
                window.showQuestion();
            }
            
            // Actualizar textos de la interfaz
            updateTexts();
        }
    }
}

// Actualizar todos los textos de la interfaz
function updateTexts() {
    // Elementos con data-key
    document.querySelectorAll('[data-key]').forEach(element => {
        const key = element.getAttribute('data-key');
        if (translations[currentLanguage][key]) {
            if (element.tagName === 'INPUT' || element.tagName === 'TEXTAREA') {
                element.placeholder = translations[currentLanguage][key];
            } else if (element.tagName === 'BUTTON' && element.id === 'nextBtn') {
                // Manejar botón siguiente/finalizar
                if (window.currentQuestionIndex !== undefined && window.selectedQuestions) {
                    const isLastQuestion = window.currentQuestionIndex === window.selectedQuestions.length - 1;
                    element.textContent = isLastQuestion ? 
                        translations[currentLanguage]['finish'] : 
                        translations[currentLanguage]['next'];
                } else {
                    element.textContent = translations[currentLanguage][key];
                }
            } else {
                element.textContent = translations[currentLanguage][key];
            }
        }
    });
    
    // Elementos especiales por ID
    const specialElements = {
        'app-title': document.getElementById('app-title'),
        'app-tagline': document.getElementById('app-tagline'),
        'offline-text': document.getElementById('offline-text'),
        'courses-title': document.getElementById('courses-title'),
        'footer-desc': document.getElementById('footer-desc'),
        'quizTitle': document.getElementById('quizTitle')
    };
    
    for (const [key, element] of Object.entries(specialElements)) {
        if (element && translations[currentLanguage][key]) {
            element.textContent = translations[currentLanguage][key];
        }
    }
    
    // Traducir nombres de cursos en el título del quiz
    if (window.currentCourse && window.courseNames) {
        const quizTitle = document.getElementById('quizTitle');
        if (quizTitle) {
            // Usar traducción si existe, sino usar el nombre original
            const courseKey = window.currentCourse + '-title';
            if (translations[currentLanguage][courseKey]) {
                quizTitle.textContent = translations[currentLanguage][courseKey];
            } else {
                quizTitle.textContent = window.courseNames[window.currentCourse];
            }
        }
    }
    
    // Guardar preferencia de idioma
    localStorage.setItem('app-language', currentLanguage);
}

// Inicializar selector de idioma
function initLanguageSelector() {
    // Botones de cambio de idioma
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            changeLanguage(this.dataset.lang);
        });
    });
    
    // Cargar idioma guardado
    const savedLang = localStorage.getItem('app-language');
    if (savedLang && translations[savedLang]) {
        changeLanguage(savedLang);
    }
}

// Función para obtener preguntas según el idioma actual
window.getQuestionsByLanguage = function(course) {
    const translated = selectTranslatedRandomQuestions(course);
    return translated || null;
};

// Función para manejar cambios de idioma en el quiz
window.updateQuizOnLanguageChange = function() {
    if (window.currentCourse) {
        updateQuizQuestions();
        
        // Actualizar textos de botones de navegación
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const backToCoursesBtn = document.getElementById('backToCourses');
        const restartQuizBtn = document.getElementById('restartQuiz');
        
        if (prevBtn) {
            prevBtn.textContent = translations[currentLanguage]['prev'] || 'Anterior';
        }
        if (nextBtn) {
            const isLastQuestion = window.currentQuestionIndex === window.selectedQuestions.length - 1;
            nextBtn.textContent = isLastQuestion ? 
                translations[currentLanguage]['finish'] : 
                translations[currentLanguage]['next'];
        }
        if (backToCoursesBtn) {
            backToCoursesBtn.textContent = translations[currentLanguage]['back-courses'] || 'Volver a Cursos';
        }
        if (restartQuizBtn) {
            restartQuizBtn.textContent = translations[currentLanguage]['repeat-course'] || 'Repetir Curso';
        }
        
        // Si estamos en la pantalla de resultados, actualizar el mensaje
        const resultsContainer = document.getElementById('resultsContainer');
        if (resultsContainer && (resultsContainer.style.display === 'block' || resultsContainer.style.display === '')) {
            const scoreMessageEl = document.getElementById('scoreMessage');
            if (scoreMessageEl && window.score !== undefined && window.selectedQuestions) {
                let messageKey = "";
                if (window.score === window.selectedQuestions.length) {
                    messageKey = "excellent-score";
                } else if (window.score >= window.selectedQuestions.length * 0.7) {
                    messageKey = "good-score";
                } else if (window.score >= window.selectedQuestions.length * 0.5) {
                    messageKey = "medium-score";
                } else {
                    messageKey = "low-score";
                }
                
                scoreMessageEl.textContent = translations[currentLanguage][messageKey];
            }
        }
    }
};

// Inicializar cuando el DOM esté listo
document.addEventListener('DOMContentLoaded', function() {
    initLanguageSelector();
    
    // Sobrescribir función showQuestion para incluir traducción
    const originalShowQuestion = window.showQuestion;
    if (originalShowQuestion) {
        window.showQuestion = function() {
            originalShowQuestion.apply(this, arguments);
            
            // Actualizar textos del quiz
            updateTexts();
        };
    }
});

// Exportar funciones para uso en otros archivos
window.translations = translations;
window.questionTranslations = questionTranslations;
window.currentLanguage = currentLanguage;
window.getTranslatedQuestions = getTranslatedQuestions;
window.changeLanguage = changeLanguage;